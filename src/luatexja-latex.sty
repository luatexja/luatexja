%
% luatexja-latex.sty
%

%! これは外から読まれない
%% Avoid multiple loading.
\csname luatexjalatexLoaded\endcsname
\edef\ltj@latex@AtEnd{%
\endlinechar=\the\endlinechar
\relax}
\endlinechar=-1 %
\def\luatexjalatexLoaded{\endinput}

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{luatexja-latex}[2011/11/22 LuaLaTeX-ja]

\def\ltj@pkgpatchlist{}
\def\ltj@pkgpatch#1{
  \@ifpackageloaded{#1}{\usepackage{lltjp-#1}}{
    \@ifpackageloaded{filehook}{\AtEndOfPackageFile*{#1}{\usepackage{lltjp-#1}}}{}
  }
  \ifx\ltj@pkgpatchlist\@empty
    \gdef\ltj@pkgpatchlist{#1}
  \else
    \xdef\ltj@pkgpatchlist{\ltj@pkgpatchlist, #1}
  \fi
}

% similar to \ltj@pkgpatch, but this is used .sty which
% can be reloaded inside the document by \input.
\def\ltj@pkgpatchA#1{
  \@ifpackageloaded{#1}{\input{lltjp-#1.sty}}{
    \@ifpackageloaded{filehook}{\AtEndOfFile{#1.sty}{\input{lltjp-#1.sty}}}{}
  }
  \ifx\ltj@pkgpatchlist\@empty
    \gdef\ltj@pkgpatchlist{#1}
  \else
    \xdef\ltj@pkgpatchlist{\ltj@pkgpatchlist, #1}
  \fi
}

\endlinechar=13

%%% patch for LaTeX
\usepackage{lltjfont}
\usepackage{lltjdefs}
\usepackage{lltjcore}

%%% default parameters
\ltjsetparameter{kanjiskip=0pt plus 0.4pt minus 0.4pt,
  xkanjiskip=.25\zw plus 1pt minus 1pt,
  autospacing, autoxspacing, jacharrange={-1},
  yalbaselineshift=0pt, yjabaselineshift=0pt,
  jcharwidowpenalty=500, differentjfm=average
}

\input luatexja-kinsoku.tex
\expandafter\let\csname JY3/mc/m/n/10\endcsname\relax

%%% patch for packages
\IfFileExists{filehook.sty}{\usepackage{filehook}}{}
\ltj@pkgpatch{listings}
\ltj@pkgpatchA{lstmisc}
\ltj@pkgpatch{unicode-math}
\ltj@pkgpatch{xunicode}
\@ifpackageloaded{filehook}{}{%
  \@PackageWarningNoLine{luatexja-latex}{
    LuaTeX-ja uses filehook package to apply patches to the following packages:\MessageBreak
    \ltj@pkgpatchlist.\MessageBreak
    But your TeX system does not have the filehook package.\MessageBreak
    Therefore problems may occur if you load the above packages after this message}%
}

%%------------------ all done
\ltj@latex@AtEnd
\endinput
%% EOF
