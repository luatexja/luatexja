\documentclass{ltjarticle}
\pdfgentounicode=1
\pdfglyphtounicode{ff}{0066 0066}
\pdfglyphtounicode{fi}{0066 0069}
\pdfglyphtounicode{fl}{0066 006C}
\pdfglyphtounicode{ffi}{0066 0066 0069}
\pdfglyphtounicode{ffl}{0066 0066 006C}
\usepackage[twoside,left=23mm,width=170mm,right=17mm,top=25mm,height=231mm,bottom=32mm]{geometry}
\usepackage{amsmath,amssymb,xcolor,pict2e,multienum,amsthm,float,makecell,multicol,showexpl}
\usepackage{hyperref}
\hypersetup{%
	backref,
	unicode,
	bookmarksnumbered,
	bookmarksopen,
	colorlinks,
	allbordercolors=1 1 1,
	allcolors=blue,
	pdfauthor={LuaTeX-ja团队},
	pdftitle={LuaTeX-ja宏包}
}


\lstset{
  basicstyle=\ttfamily\small, pos=o, breaklines=true,
  numbers=none, rframe={}, basewidth=0.5em
}
\DeclareYokoKanjiEncoding{ZH}{}{}
\DeclareKanjiEncodingDefaults{}{}
\DeclareErrorKanjiFont{ZH}{song}{m}{n}{10}
\DeclareKanjiSubstitution{ZH}{song}{m}{n}
\newcommand\songdefault{song}
\newcommand\heidefault{hei}
\renewcommand\kanjiencodingdefault{ZH}
\renewcommand\kanjifamilydefault{\songdefault}
\renewcommand\kanjiseriesdefault{\mddefault}
\renewcommand\kanjishapedefault{\updefault}
\DeclareKanjiFamily{ZH}{song}{}
\DeclareFontShape{ZH}{song}{m}{n}{<->name:AdobeSongStd-Light:jfm=jis}{}
\DeclareFontShape{ZH}{song}{bx}{n}{<->ssub*hei/m/n}{}
\DeclareKanjiFamily{ZH}{hei}{}
\DeclareFontShape{ZH}{hei}{m}{n}{<->name:AdobeHeitiStd-Regular:jfm=jis}{}
\fontencoding{ZH}\selectfont
\DeclareTextFontCommand{\textsong}{\songfamily}
\DeclareTextFontCommand{\texthei}{\heifamily}
\DeclareOldFontCommand{\song}{\normalfont\songfamily}{}
\DeclareOldFontCommand{\hei}{\normalfont\heifamily}{}
\DeclareSymbolFont{songti}{ZH}{song}{m}{n}
\jfam\symsongti
\SetSymbolFont{songti}{bold}{ZH}{hei}{m}{n}
\DeclareSymbolFontAlphabet{\mathsong}{songti}
\DeclareMathAlphabet{\mathhei}{ZH}{hei}{m}{n}
\makeatletter
\DeclareRobustCommand\songfamily{\not@math@alphabet\songfamily\mathsong\kanjifamily\songdefault\selectfont}
\DeclareRobustCommand\heifamily{\not@math@alphabet\heifamily\mathhei\kanjifamily\heidefault\selectfont}
\DeclareRobustCommand\rmfamily{\not@math@alphabet\rmfamily\mathrm\romanfamily\rmdefault\kanjifamily\songdefault\selectfont}
\DeclareRobustCommand\sffamily{\not@math@alphabet\sffamily\mathsf\romanfamily\sfdefault\kanjifamily\heidefault\selectfont}
\makeatother
\def\postpartname{编}
\def\LuaTeX{Lua\TeX}
\def\pTeX{p\TeX}
\def\pLaTeX{p\LaTeX}
\def\upTeX{up\TeX}
\def\eTeX{$\varepsilon$-\TeX}
\def\epTeX{$\varepsilon$-p\TeX}
\title{\LuaTeX-ja宏包}
\author{\LuaTeX-ja项目团队}
\date{}
\begin{document}
\maketitle
\tableofcontents
\part{用户手册}
\section{引言}
\LuaTeX-ja宏包是应用于\LuaTeX引擎上的高质量日语文档排版宏包。
\subsection{开发背景}
一般情况下，\TeX下的日语文档输出，是ASCII \pTeX（\TeX的一个扩展）及其衍生软件来完成的。
\pTeX作为\TeX的一个扩展引擎，在生成高质量的日语文档时，规避了繁杂的宏编写。
但是在和同时期的引擎相比之下，\pTeX的处境未免有些尴尬：\pTeX已经远远落后于\eTeX和pdf\TeX，此外也没有跟上计算机上对日文处理的演进（比如，UTF-8编码，TrueType字体，OpenType字体）。

最近开发的\pTeX扩展，即\upTeX（Unicode下的\pTeX实现）和\epTeX（\pTeX和\eTeX的融合版本），虽然在部分情况上弥补了上述的差距，但是差距依然存在。

不过，\LuaTeX的出现改变了整个状况。用户可以通过使用Lua语言的“callback”来调整\LuaTeX的内部处理机制。所以，没有必要去通过修改引擎的源代码来支持日文排版，相反，我们需要做的仅仅是编写其当处理callback的Lua脚本。
\subsection{与\pTeX的差异所在}
\LuaTeX-ja宏包在设计上，受\pTeX影响很大。最初开发的主要议题是实现\pTeX的特性。
不过，{\bf\LuaTeX-ja不是简简单单的移植\pTeX，很多不自然的特征和现象都被移出了。}

下面列举出了一些和\pTeX的差异：
\begin{itemize}
\item 一个日文字体是由三部分构成的元组：实际的字体（如小塚明朝，IPA明朝），日文字体测度（\textbf{JFM}）和变体字串。
\item \pTeX中，日文字符之后的断行并不允许（也不产生空格），其他在源码中的断行是可以随处允许的。不过，因为\LuaTeX的特殊关系，\LuaTeX-ja并没有这个功能。
\item 插在日文字符和其他字符言之间的胶/出格（我们将此称为\textbf{JAglue}）是重现实现的。
	\begin{itemize}
	\item 在\LuaTeX中，内部的字符处理是“基于node的”（例如：\verb!of{}fice!不会避免合字），
		\textbf{JAglue}的插入处理，现在也是“基于node的”。
	\item 此外，两个字符之间的node在断行时不起作用的（例如，\verb!\special!node），还有
		意大利体校正带来的出格在插入处理中也是被忽略的。
	\item \textbf{警告：鉴于以上两点，在\pTeX中分割\textbf{JAglue}处理的多种方法不再生效。}
		明确地说，下列两种方法不再生效：
		\begin{verbatim}
		　　ちょ{}っと　　ちょ\/っと
		\end{verbatim}
		如果想得到此种结果，请使用空盒子替代：
		\begin{verbatim}
		　　ちょ\hbox{}っと
		\end{verbatim}
	\item 处理过程中，两个在“真实”字体上具区别的日文字体可以被识别出来。
	\end{itemize}
\item 当下，\LuaTeX-ja并不支持直行排版。
\end{itemize}
\subsection{一些约定} 
在本文档中，有下面一些约定：
\begin{itemize}
\item 所有的日文字符为\textbf{JAchar}，所有的其他字符为\textbf{ALchar}
\item primitive，该词在本文档中不仅表示\LuaTeX的基本控制命令，也包括\LuaTeX-ja的相关的基本控制命令
\item 所有的自然数从0开始
\item 本文档中文文档是根据日文文档翻译并添加部分材料组织而成的，所以在大部分篇幅上还是主要依赖于日文原文档
\end{itemize}
\subsection{关于本项目}
\paragraph{项目wiki} 本项目wiki正在不断编写中。
\begin{itemize}
\item \url{http://sourceforge.jp/projects/luatex-ja/wiki/FrontPage%28en%29}（英文）
\item \url{http://sourceforge.jp/projects/luatex-ja/wiki/FrontPage}（日文）
\item \url{http://sourceforge.jp/projects/luatex-ja/wiki/FrontPage%28zh%29}（中文）
\end{itemize}
\paragraph{开发者}
\begin{multienumerate}
\def\labelenumi{$\bullet$}
\mitemxxx{北川弘典}{前田一贵}{八登崇之}
\mitemxxx{黒木裕介}{阿部纪行}{山本宗宏}
\mitemxxx{本田知亮}{斋藤修三郎}{马起园}
\end{multienumerate}
\section{初次使用}
\subsection{安装}
在安装\LuaTeX-ja之前，请确认：
\begin{itemize}
\item \LuaTeX（版本号为大于0.65）和相关支持宏包。\\
如果用户使用的是\TeX Live2011以及最新版本的W32\TeX，都可以不考虑此项。
\item \LuaTeX-ja的源码:)
\item \underline{\texttt{xunicode}}宏包，当前版本必须为\textit{v0.981(2011/09/09)}。\\
如果你使用\underline{\texttt{fontspec}}宏包，\underline{\texttt{xunicode}}必须存在。但是请注意该包版本，其他版本可能不会正常工作。
\end{itemize}
安装方法如下：
\begin{enumerate}
\item 用下列诸多方法下载源码归档。当前，\LuaTeX-ja并无\textbf{稳定}版本。
	\begin{itemize}
	\item 从git中复制\\
		\verb!$ git clone git://git.sourceforge.jp/gitroot/luatex-ja/luatexja.git!
	\item 下载\texttt{master}分支HEAD的\texttt{tar.gz}归档\\
		\url{http://git.sourceforge.jp/view?p=luatex-ja/luatexja.git;a=snapshot;h=HEAD;sf=tgz}
	\item 现在\LuaTeX-ja已经包含于CTAN中（在\texttt{macros/luatex/generic/luatexja}文件夹）和W32\TeX中（\texttt{luatexja.tar.gz}）。这些版本基于\texttt{master}版本。
	\end{itemize}
\item 用户需要将获取的\LuaTeX-ja宏包的\verb!src/!放置到你所用的发行版中的\verb!TEXMFLOACL!树下\verb!tex/!文件夹（如果不存在，请建立）下即可，查询该环境变量需要使用：\\
	\verb!$ kpeswhich -expand-var "$TEXMFLOCAL"!
\item 刷新数据库：\\
	\verb!$ texhash!\\
	\verb!$ mkluatexfontdb!
\end{enumerate}
\section{\LuaTeX-ja在plain \TeX格式下的使用}
对于日本用户，日文的排版可以直接使用：
\begin{verbatim}
\input luatexja.sty
\end{verbatim}

这一行会默认调用\verb!luatexja.sty!文件，该文件作用相当于\pTeX中的\verb!ptex.tex!。该文件中设定了两款非嵌入字体：Ryumin-Light（明朝体）和GothicBBB-Medium（哥特体）。
这些字体分别有三种大小：\verb!\tenmin!和\verb!\tengt!（10pt）；\verb!\sevenmin!和\verb!\sevengt!（7pt）；\verb!\fivemin!和\verb!\fivegt!（5pt）。

有几点请用户注意：
\begin{itemize}
\item 上述的两款字体需要你的pdf阅读器带有良好的非嵌入字体的支持，这里建议使用Adobe Reader，该阅读器使用了Kozuka Mincho字体。
\item 在定义字体的时候，可以使用“级”（Q）单位，$1 \mathrm{Q} = 0.25\mathrm{mm}$，在\LuaTeX-ja中可以使用\verb!\jQ!命令调用该长度单位
\item 一般情况下，相同大小日文字体比西文字体要大一下（中文字体也是如此），所以定义日文字体的时候需要一个缩放率：0.962216
\item 在\textbf{JAchar}和\textbf{ALchar}之间插入的胶大小为：$(0.25\times0.962216\times\mathrm{10pt})^{\mathrm{+1pt}}_{\mathrm{-1pt}} = 2.40554\mathrm{pt}^{\mathrm{+1pt}}_{\mathrm{-1pt}}$
\end{itemize}
\section{\LuaTeX-ja在\LaTeXe格式的使用}
\subsection{日文排版设置}
在\LaTeXe下使用\LuaTeX-ja比较便利：
\begin{verbatim}
\usepackage{luatexja}
\end{verbatim}

该宏包的作用相当于\pLaTeX中的\verb!plfonts.dtx!和\verb!pldefs.ltx!。
\begin{itemize}
\item 在该宏包中设定了\verb!JY3!编码，这个编码用来调用日文字体
\item 该宏包定义了两个字体族：\verb!mc!和\verb!gt!。\\
\begin{center}
	\begin{tabular}{ccccc}
	\hline
	字体&字体族&\verb!\mdseries!&\verb!\bfseries!&缩放率\\
	\hline
	\textit{mincho}&\verb!mc!&Ryumin-Light&GothicBBB-Medium&0.962216\\
	\textit{gothic}&\verb!gt!&GothicBBB-Medium&GothicBBB-Medium&0.962216\\
	\hline
	\end{tabular}
\end{center}
\item 在数学模式下，所有的字符使用\verb!mc!字体族来排印
\end{itemize}

上述使用的宏包，只满足了最小的日文环境设定需求，并为满足所有的日文排版需求。
\LuaTeX-ja宏包提供了两个文档类：\verb!jclasses!（\pLaTeX标准文档类）和\verb!jsclasses!（奥村晴彦）。用户可自行选择两种文档类。
\subsection{fontspec}
在\LuaTeX-ja中，和\texttt{fontspec}共存的一个包为\texttt{luatexja-fontspec}。
这个包自动加载\texttt{fontspec}和\texttt{luatexja}宏包。

在\texttt{luatexja-fontspec}，定义了如下七条命令，这些命令和\texttt{fontspec}的相关命令对比如下：
\begin{center}
	\begin{tabular}{ccccc}
	\hline
	日文字体&\verb+\jfontspec+&\verb+\setmainjfont+&\verb+\setsansjfont+&\verb+\newjfontfamily+\\
	西文字体&\verb+\fontspec+&\verb+\setmainfont+&\verb+\setsansfont+&\verb+\newfontfamily+\\
	\hline
	日文字体&\verb+\newjfontface+&\verb+\defaultjfontfeatures+&\verb+\addjfontfeatures+&\\
	西文字体&\verb+\newfontface+&\verb+\defaultfontfeatures+&\verb+\addfontfeatures+&\\
	\hline
	\end{tabular}
\end{center}
\section{\LuaTeX-ja参数设定}
\LuaTeX-ja包含大量的参数，以控制排版细节。
设定这些参数需要使用命令：\verb!\ltjsetparameter!和\verb!\ltjgetparameter!命令。
\subsection{JAchar范围的设定}
在设定\textbf{JAchar}之前，需要分配一个小于217的自然数。如：
\begin{verbatim}
\ltjdefcharrange{100}{"10000-"1FFFF,`漢}
\end{verbatim}

请注意这个设定是全局性的，不建议在文档正文中进行设定。

在范围设定好了之后，需要进行\verb!jacharrange!的设定：
\begin{verbatim}
\ltjsetparameter{jacharrange={-1, +2, +3, -4, -5, +6, +7, +8}}
\end{verbatim}

这里定义了8个范围，在每个范围之前使用“+”或“-”进行设定，其中如果为$-$，则代表该范围为\textbf{ALchar}，如果为$+$，则该范围视作\textbf{JAchar}。

\LuaTeX-ja默认设定了8个范围，这些范围来源于下列数据：
\begin{itemize}
\item Unicode 6.0
\item Adobe-Japan1-6与Unicode之间的映射\verb!Adobe-Japan1-UCS2!
\item 八登崇之的up\TeX宏包：\verb!PXbase!
\end{itemize}

\begin{description}
\item[范围 $\mathbf{8^J}$] ISO 8859-1（Latin-1补充）的上半部和JIS X 0208（日文基本字符集）的重叠部分，包含下列字符：
\begin{multicols}{2}
	\begin{itemize}
	\def\ch#1#2{\item \char"#1\ (\texttt{U+00#1}, #2)}
	\ch{A7}{Section Sign}
	\ch{A8}{Diaeresis}
	\ch{B0}{Degree sign}
	\ch{B1}{Plus-minus sign}
	\ch{B4}{Spacing acute}
	\ch{B6}{Paragraph sign}
	\ch{D7}{Multiplication sign}
	\ch{F7}{Division Sign}
	\end{itemize}
\end{multicols}

\item[范围 $\mathbf{1^A}$] 包含于Adobe-Japan1-6中的拉丁字符，此范围包含下列Unicode区域，但不包括上述提到过的范围8：
\begin{multicols}{2}
	\begin{itemize}
	\item \texttt{U+0080}--\texttt{U+00FF}: 拉丁字母补充-1
	\item \texttt{U+0100}--\texttt{U+017F}: 拉丁字母扩充-A
	\item \texttt{U+0180}--\texttt{U+024F}: 拉丁字母扩充-B
	\item \texttt{U+0250}--\texttt{U+02AF}: 国际音标扩充
	\item \texttt{U+02B0}--\texttt{U+02FF}: 进格修饰符元
	\item \texttt{U+0300}--\texttt{U+036F}: 组合音标附加符号
	\item \texttt{U+1E00}--\texttt{U+1EFF}: 拉丁字母扩充附加
	\end{itemize}
\end{multicols}

\item[范围 $\mathbf{2^J}$] 希腊文和西里尔字母，使用JIS X 0208的大部分日文字体包含这些字符：
\begin{multicols}{2}
	\begin{itemize}
	\item \texttt{U+0370}--\texttt{U+03FF}: 希腊字母
	\item \texttt{U+0400}--\texttt{U+04FF}: 西里尔字母	
	\item \texttt{U+1F00}--\texttt{U+1FFF}: 希腊文扩充
	\end{itemize}
\end{multicols}

\item[范围 $\mathbf{3^J}$] 标点以及杂项符号：
\begin{multicols}{2}
	\begin{itemize}
	\item \texttt{U+2000}--\texttt{U+206F}: 一般标点符号
	\item \texttt{U+2070}--\texttt{U+209F}: 上标及下标
	\item \texttt{U+20A0}--\texttt{U+20CF}: 货币符号
	\item \texttt{U+20D0}--\texttt{U+20FF}: 符号用组合附加符号
	\item \texttt{U+2100}--\texttt{U+214F}: 类字母符号
	\item \texttt{U+2150}--\texttt{U+218F}: 数字形式
	\item \texttt{U+2190}--\texttt{U+21FF}: 箭头符号
	\item \texttt{U+2200}--\texttt{U+22FF}: 数学运算符号
	\item \texttt{U+2300}--\texttt{U+23FF}: 杂项技术符号
	\item \texttt{U+2400}--\texttt{U+243F}: 控制图像
	\item \texttt{U+2500}--\texttt{U+257F}: 制表符
	\item \texttt{U+2580}--\texttt{U+259F}: 区块元素
	\item \texttt{U+25A0}--\texttt{U+25FF}: 几何形状
	\item \texttt{U+2600}--\texttt{U+26FF}: 杂项符号
	\item \texttt{U+2700}--\texttt{U+27BF}: 什锦符号
	\item \texttt{U+2900}--\texttt{U+297F}: 补充性箭头-B
	\item \texttt{U+2980}--\texttt{U+29FF}: 混合数学符号-B
	\item \texttt{U+2B00}--\texttt{U+2BFF}: 杂项符号和箭头符号
	\item \texttt{U+E000}--\texttt{U+F8FF}: 私用区域
	\end{itemize}
\end{multicols}

\item[范围 $\mathbf{4^A}$] 通常情况下不包含于日文字体的部分。本范围包含有其他范围尚未涵盖部分。故，我们直接给出定义：
\begin{verbatim}
\ltjdefcharrange{4}{%
   "500-"10FF, "1200-"1DFF, "2440-"245F, "27C0-"28FF, "2A00-"2AFF, 
  "2C00-"2E7F, "4DC0-"4DFF, "A4D0-"A82F, "A840-"ABFF, "FB50-"FE0F, 
  "FE20-"FE2F, "FE70-"FEFF, "FB00-"FB4F, "10000-"1FFFF} % non-Japanese
\end{verbatim}

\item[范围 $\mathbf{5^A}$] 代替以及补充私有使用区域。
\item[范围 $\mathbf{6^J}$] 日文字符。
\begin{multicols}{2}
	\begin{itemize}
	\item \texttt{U+2460}--\texttt{U+24FF}: 圈状字母数字
	\item \texttt{U+2E80}--\texttt{U+2EFF}: CJK部首补充
	\item \texttt{U+3000}--\texttt{U+303F}: CJK标点符号
	\item \texttt{U+3040}--\texttt{U+309F}: 平假名
	\item \texttt{U+30A0}--\texttt{U+30FF}: 片假名
	\item \texttt{U+3190}--\texttt{U+319F}: 汉文标注号
	\item \texttt{U+31F0}--\texttt{U+31FF}: 片假名音标补充
	\item \texttt{U+3200}--\texttt{U+32FF}: 圈状CJK字母及月份
	\item \texttt{U+3300}--\texttt{U+33FF}: CJK兼容
	\item \texttt{U+3400}--\texttt{U+4DBF}: CJK统一表意文字扩充A		\item \texttt{U+4E00}--\texttt{U+9FFF}: CJK统一表意文字
	\item \texttt{U+F900}--\texttt{U+FAFF}: CJK兼容表意文字
	\item \texttt{U+FE10}--\texttt{U+FE1F}: 直行标点
	\item \texttt{U+FE30}--\texttt{U+FE4F}: CJK兼容形式
	\item \texttt{U+FE50}--\texttt{U+FE6F}: 小写变体
	\item \texttt{U+20000}--\texttt{U+2FFFF}: （补充字符）
	\end{itemize}
\end{multicols}

\item[范围 $\mathbf{7^J}$] 不包含于Adobe-Japan1-6的CJK字符。
\begin{multicols}{2}
	\begin{itemize}
	\item \texttt{U+1100}--\texttt{U+11FF}: 谚文字母
	\item \texttt{U+2F00}--\texttt{U+2FDF}: 康熙部首
	\item \texttt{U+2FF0}--\texttt{U+2FFF}: 汉字结构描述字符
	\item \texttt{U+3100}--\texttt{U+312F}: 注音字母
	\item \texttt{U+3130}--\texttt{U+318F}: 谚文兼容字母
	\item \texttt{U+31A0}--\texttt{U+31BF}: 注音字母扩充
	\item \texttt{U+31C0}--\texttt{U+31EF}: CJK笔划
	\item \texttt{U+A000}--\texttt{U+A48F}: 彝文音节
	\item \texttt{U+A490}--\texttt{U+A4CF}: 彝文字母
	\item \texttt{U+A830}--\texttt{U+A83F}: 一般印度数字
	\item \texttt{U+AC00}--\texttt{U+D7AF}: 谚文音节
	\item \texttt{U+D7B0}--\texttt{U+D7FF}: 谚文字母扩充-B
	\end{itemize}
\end{multicols}
\end{description}
\subsection{\textsf{kanjiskip}和\textsf{xkanjiskip}}
\textbf{JAglue}分为下列三类范畴：
\begin{itemize}
\item JFM设定的胶或出格值。如果在一个日文字符附近使用\verb!\inhibitglue!，则胶便不会插入。
\item 两个\textbf{JAchar}之间默认插入的胶（\textsf{kanjiskip}）
\item \textbf{JAchar}和\textbf{ALchar}之间默认插入的胶（\textsf{xkanjiskip}）
\end{itemize}

\textsf{kanjiskip}和\textsf{xkanjiskip}的设定如下所示：
\begin{verbatim}
\ltjsetparameter{kanjiskip={0pt plus 0.4pt minus 0.4pt},
                 xkanjiskip={0.25\zw plus 1pt minus 1pt}}
\end{verbatim}

当JFM包含“\textsf{kanjiskip}理想宽度”和/或“\textsf{xkanjiskip}理想宽度”数据时，上述设定产生作用。如果想用JFM中的数据，请设定\textsf{kanjiskip}或\textsf{xkanjiskip}为\verb!\maxdimen!。
\subsection{\textsf{xkanjiskip}插入设定}
并不是在所有的\textbf{JAchar}和\textbf{ALchar}周围插入\textsf{xkanjiskip}都是合适的。
比如，在开标点之后插入\textsf{xkanjiskip}并不合适[如，比较“(あ”和“(\hskip\ltjgetparameter{xkanjiskip}あ”]。
\LuaTeX-ja可以通过设定\textbf{JAchar}的\textsf{jaxspmode}以及\textbf{ALchar}的\textsf{alxspmode}来控制\textsf{xkanjiskip}在字符前后的插入。

\begin{LTXexample}[pos=r]
\ltjsetparameter{jaxspmode={`あ,preonly}, alxspmode={`\!,postonly}}
pあq い!う
\end{LTXexample}

第二个参数\textsf{preonly}表示的含义为“允许在该字符前插入\textsf{xkanjiskip}，但不允许在该字符之后插入”。
其他参数还有\textsf{postonly}，\textsf{allow}和\textsf{inhibit}。[TODO]

用户如果想开启/关闭\textsf{kanjiskip}和\textsf{xkanjiskip}的插入，设定\textsf{autospacing}和\textsf{autoxspacing}参数为\textsf{true}/\textsf{false}即可。
\subsection{基线浮动}
为了确保日文字体和西文字体能够对其，有时需要浮动其中一者的基线。
在\pTeX中，此项设定由设定\verb!\yabaselineshift!为非零长度（西文字体基线应向下浮动）。
不过，如果文档的中主要语言不是日文，那么最好上浮日文字体的基线，西文字体不变。
如上所述，\LuaTeX-ja可以独立设定西文字体的基线（\textsf{yabaselineshift}参数）和日文字体的基线（\textsf{yjabaselineshift}参数）。

\begin{LTXexample}[pos=r]
\vrule width 150pt height 0.4pt depth 0pt\hskip-120pt
\ltjsetparameter{yjabaselineshift=0pt, yalbaselineshift=0pt}abcあいう
\ltjsetparameter{yjabaselineshift=5pt, yalbaselineshift=2pt}abcあいう
\end{LTXexample}

上述水平线为此行基线。

这里还有一个有趣的副作用：不同大小的字符可以通过适当调整这两个参数而在一行中垂直居中。下面是一个例子（注意，参数值并没有精心调整）：

\begin{LTXexample}[pos=r]
xyz漢字
{\scriptsize
  \ltjsetparameter{yjabaselineshift=-1pt,
    yalbaselineshift=-1pt}
  XYZひらがな
}abcかな
\end{LTXexample}
\subsection{裁剪框标记}
裁剪框标记是在一页的四角和水平/垂直中央放置的标记。在日文中，裁剪框被称为“トンボ”。
\pLaTeX和\LuaTeX-ja均在底层支持裁剪框标记。需要下列步骤来实现：
\begin{enumerate}
\item 首先，首先定义页面左上角将会出现的注记。这由向\verb!@bannertoken!分配一个token列完成。\\
例如，下列所示将会设定注记为“\textsf{filename (YYYY-MM-DD hh:mm)}”:

\begin{verbatim}
\makeatletter

\hour\time \divide\hour by 60 \@tempcnta\hour \multiply\@tempcnta 60\relax
\minute\time \advance\minute-\@tempcnta
\@bannertoken{%
   \jobname\space(\number\year-\two@digits\month-\two@digits\day
   \space\two@digits\hour:\two@digits\minute)}%
\end{verbatim}

\item {[TODO]}
\end{enumerate}
%\part{参考指南}
%\section{字体测度和日文字体}
%\subsection{\texttt{jfont}基本语句}
%\subsection{\texttt{psft}前缀}
%\subsection{JFM文件结构}
%\subsection{数学字体族}
%\subsection{Callbacks}
%\part{实现细节}
%\section{Lua\TeX-ja与Lua\TeX相关阅读材料}
%\begin{itemize}
%\item Lua\TeX官方主页：\verb!http://www.luatex.org!
%\item Lua\TeX\ SVN：\verb!http://foundry.supelec.fr/gf/project/luatex/!
%\item Lua\TeX：\verb!http://ja.wikipedia.org/wiki/LuaTeX!
%\item Lua\TeX-ja官方主页：\verb!http://en.sourceforge.jp/projects/luatex-ja/!
%\item p\TeX官方主页：\verb!http://ascii.asciimw.jp/pb/ptex/!
%\item Publishing \TeX：\verb!http://ja.wikipedia.org/wiki/PTeX!
%\item Vertical typesetting in \TeX：\verb!http://tug.org//TUGboat/Articles/tb11-3/tb29hamano.pdf!
%\item up\TeX官方主页：\verb!http://homepage3.nifty.com/ttk/comp/tex/uptex.html!
%\item “LuaTeX で日本語”：\verb!http://oku.edu.mie-u.ac.jp/tex/mod/forum/discuss.php?d=627!
%\item luajalayout宏包：\verb!http://www-is.amp.i.kyoto-u.ac.jp/lab/kmaeda/lualatex/luajalayout/!
%\item luafontcomp宏包：\verb!http://www-is.amp.i.kyoto-u.ac.jp/lab/kmaeda/lualatex/luafontcomp/!
%\item 思わずLuaでLaTeXしてみた：\verb!http://zrbabbler.sp.land.to/lualatexlua.html!
%\item luaums.sty：\verb!http://oku.edu.mie-u.ac.jp/tex/mod/forum/discuss.php?d=378!
%\item koTeXは日本語LuaTeXへの先導役になるか？：\\\verb!http://oku.edu.mie-u.ac.jp/tex/mod/forum/discuss.php?d=485!
%\end{itemize}
\end{document}
