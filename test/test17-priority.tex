%#!lualatex

\documentclass{article}
\usepackage{luatexja,luacode,xcolor}
\RequireLuaTeXjaSubmodule{adjust}

\def\sq{%
  \hbox to 1\zw{\hss\fboxsep=-.5\fboxrule\fbox{%
  　\hskip\dimexpr-.5\zw-.2pt\vrule width.4pt height.08\zw depth.12\zw%
  \hskip\dimexpr.5\zw-.2pt\relax}\hss}}
\def\sb{\hbox to 1\zw{\hss\fboxsep=-.5\fboxrule\fbox{%
  ■\hskip\dimexpr-.5\zw-.2pt\vrule width.4pt height.08\zw depth.12\zw%
  \hskip\dimexpr.5\zw-.2pt\relax}\hss}}
\newbox\gridbox
\setbox\gridbox=\hbox to 20\zw{\sq\sq\sq\sq\sb\sq\sq\sq\sq\sb\sq\sq\sq\sq\sb\sq\sq\sq\sq\sb}
\def\outbox#1{%
  \leavevmode\hbox to 2em{\tt #1\hss}\vrule
  \textcolor{cyan!50!white}{\copy\gridbox}\hskip-20\zw\copy0\vrule\par
}

\def\DisableCB{\directlua{luatexbase.remove_from_callback('post_linebreak_filter', 'Adjust width')}}
\def\EnableCB{\directlua{luatexbase.add_to_callback('post_linebreak_filter', luatexja.adjust.adjust_width, 'Adjust width', 100)}}

\long\def\testbox#1{%
  \EnableCB\setbox0=\vbox{\hsize=20\zw\parfillskip0pt#1}\outbox{ON}\par
  \DisableCB\setbox0=\vbox{\hsize=20\zw\parfillskip0pt#1}\outbox{OFF}\par
}

\parindent0pt
\begin{document}
{\tt kanjiskip: \ltjgetparameter{kanjiskip}

\ltjsetparameter{xkanjiskip=.25\zw plus .25\zw minus .125\zw}
xkanjiskip: \ltjgetparameter{xkanjiskip}}

\testbox{%
◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆◆
%あいうえおかきくけこさしすせそたちつてと
}

\testbox{%
あいうえおかきくけこ「「さしすせそたちつて
}

\testbox{%
あいうえおかきA B C Dこさ\texttt{DO i=1,10}『
}

\testbox{%
「\texttt{\textbackslash expandafter}ユーザの集い」が開催された
}

\testbox{%
あいうえおきくけこ「」さ123456そたちつて
}

\def\pTeX{p\kern-.2em\TeX}
\testbox{%
日本では\pTeX，p\LaTeX がよく使われている。
}

中点類の空き詰めは括弧類より優先

\testbox{%
あいうえおかきくけ・こさしすせそたち「「あ
}
\end{document}